<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <title>Employees</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css"/>
</head>
<body>
<div class="topbar">
    <div class="brand">Spring MVC • Employees</div>
    <a class="btn btn-light" th:href="@{/employees}">Odśwież</a>
</div>

<div class="container">

    <div class="card">
        <h1>Pracownicy</h1>
        <p class="subtitle">Lista wszystkich pracowników w systemie</p>

        <table class="table">
            <thead>
            <tr>
                <th style="width:70px;">ID</th>
                <th>Imię</th>
                <th>Nazwisko</th>
                <th>Wynagrodzenie</th>
                <th>Telefon</th>
                <th>Email</th>
                <th style="width:240px;">Akcje</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="emp : ${employees}">
                <td th:text="${emp.employeeId}">1</td>
                <td th:text="${emp.name}">Jan</td>
                <td th:text="${emp.surname}">Kowalski</td>
                <td th:text="${emp.salary}">10000.00</td>
                <td th:text="${emp.phone}">123-456-789</td>
                <td th:text="${emp.email}">jan@example.com</td>
                <td>
                    <div class="form-actions">
                        <a class="btn btn-light" th:href="@{'/employees/show/' + ${emp.employeeId}}">Szczegóły</a>

                        <button type="button"
                                class="btn btn-primary"
                                th:attr="data-target=${'edit-' + emp.employeeId}"
                                onclick="toggleEdit(this)">
                            Edytuj
                        </button>

                        <form th:action="@{'/employees/delete/' + ${emp.employeeId}}" method="post" style="display:inline;">
                            <input type="hidden" name="_method" value="DELETE"/>
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-danger">Usuń</button>
                        </form>
                    </div>
                </td>
            </tr>

            <!-- wiersz edycji (collapsible) -->
            <tr th:each="emp,iterStat : ${employees}">
                <td colspan="7" style="padding:0; border-top:none;">
                    <div th:id="${'edit-' + emp.employeeId}" style="display:none; padding:16px;">
                        <div class="card" style="margin:0;">
                            <h3>Edytuj pracownika #<span th:text="${emp.employeeId}">1</span></h3>
                            <p class="subtitle">Zmień dane i zapisz</p>

                            <form class="form" th:action="@{/employees/update}" method="post">
                                <!-- emulacja PUT -->
                                <input type="hidden" name="_method" value="PUT"/>
                                <input type="hidden" name="employeeId" th:value="${emp.employeeId}"/>

                                <div class="form-row">
                                    <label for="name" th:for="${'name-' + emp.employeeId}">Imię</label>
                                    <input type="text"
                                           th:id="${'name-' + emp.employeeId}"
                                           name="name"
                                           th:value="${emp.name}"
                                           required/>
                                </div>

                                <div class="form-row">
                                    <label th:for="${'surname-' + emp.employeeId}">Nazwisko</label>
                                    <input type="text"
                                           th:id="${'surname-' + emp.employeeId}"
                                           name="surname"
                                           th:value="${emp.surname}"
                                           required/>
                                </div>

                                <div class="form-row">
                                    <label th:for="${'salary-' + emp.employeeId}">Wynagrodzenie</label>
                                    <input type="number"
                                           th:id="${'salary-' + emp.employeeId}"
                                           name="salary"
                                           th:value="${emp.salary}"
                                           min="0" step="0.01" required/>
                                </div>

                                <div class="form-row">
                                    <label th:for="${'phone-' + emp.employeeId}">Telefon</label>
                                    <input type="tel"
                                           th:id="${'phone-' + emp.employeeId}"
                                           name="phone"
                                           th:value="${emp.phone}"/>
                                </div>

                                <div class="form-row">
                                    <label th:for="${'email-' + emp.employeeId}">Email</label>
                                    <input type="email"
                                           th:id="${'email-' + emp.employeeId}"
                                           name="email"
                                           th:value="${emp.email}"/>
                                </div>

                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">Zapisz</button>
                                    <button type="button" class="btn btn-light"
                                            th:attr="data-target=${'edit-' + emp.employeeId}"
                                            onclick="toggleEdit(this)">
                                        Anuluj
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </td>
            </tr>
            <!-- koniec wiersza edycji -->

            </tbody>
        </table>
    </div>

    <div class="card">
        <h2>Dodaj pracownika</h2>
        <p class="subtitle">Wypełnij podstawowe dane i zapisz nową pozycję</p>

        <form class="form" th:action="@{/employees/add}" method="post" th:object="${EmployeeDTO}">
            <div class="form-row">
                <label for="name">Imię</label>
                <input id="name" type="text" th:field="*{name}" placeholder="np. Jan" required/>
            </div>
            <div class="form-row">
                <label for="surname">Nazwisko</label>
                <input id="surname" type="text" th:field="*{surname}" placeholder="np. Kowalski" required/>
            </div>
            <div class="form-row">
                <label for="salary">Wynagrodzenie</label>
                <input id="salary" type="number" th:field="*{salary}" placeholder="np. 10000" min="0" step="1" required/>
            </div>
            <div class="form-row">
                <label for="phone">Telefon</label>
                <input id="phone" type="tel" th:field="*{phone}" placeholder="np. 123-456-789"/>
            </div>
            <div class="form-row">
                <label for="email">Email</label>
                <input id="email" type="email" th:field="*{email}" placeholder="np. jan@example.com"/>
            </div>

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Zapisz</button>
                <a class="btn btn-light" th:href="@{/employees}">Anuluj</a>
            </div>
        </form>
    </div>

</div>

<script>
    function toggleEdit(btn) {
        const id = btn.getAttribute('data-target');
        const panel = document.getElementById(id);
        if (!panel) return;
        const isHidden = panel.style.display === 'none' || panel.style.display === '';
        panel.style.display = isHidden ? 'block' : 'none';
        // Opcjonalnie przewiń do panelu
        if (isHidden) {
            panel.scrollIntoView({behavior: 'smooth', block: 'center'});
        }
    }
</script>
</body>
</html>